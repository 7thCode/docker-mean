server {
        client_max_body_size 200M;
        listen       80;
        server_name  45.77.30.203;

        #access_log  logs/host.access.log  main;

	location / {
            proxy_buffering off;
            proxy_pass http://localhost:3000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            if ($http_user_agent ~* "(facebookexternalhit/[0-9]|Twitterbot|Discordbot)") {
                rewrite ^/u/(.*)$ http://localhost:3000/seo/$1 permanent;
            }
        }

        location /papi/ {
            proxy_buffering off;
            proxy_pass http://localhost:5000/;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }

        location /ws {
            proxy_pass http://localhost:3001;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
       }

       # output compression saves bandwidth
        gzip  on;
        gzip_http_version 1.1;
        gzip_vary on;
        gzip_comp_level 6;
        gzip_proxied any;
        gzip_types text/plain
            text/css
            text/xml
            text/javascript
            application/json
            application/javascript
            application/xml
            application/xhtml+xml
            application/rss+xml
            application/x-javascript
            application/atom+xml
            application/x-httpd-php;

        # make sure gzip does not lose large gzipped js or css files
        # see http://blog.leetsoft.com/2007/07/25/nginx-gzip-ssl.html
        gzip_buffers 16 8k;

        # Disable gzip for certain browsers.
        gzip_disable “MSIE [1-6].(?!.*SV1)”;

}

